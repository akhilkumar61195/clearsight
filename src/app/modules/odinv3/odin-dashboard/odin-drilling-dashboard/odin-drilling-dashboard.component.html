<div class="blue-background odin-blue-background">
  <div class="search-input">
    <span class="p-input-icon-left inputsearchSpan">
      <i class="pi pi-search"></i>
      <input pInputText type="text" #searchOdinDashboard [(ngModel)]='searchValue' class="whiteblue"
        [disabled]="unsavedChanges" (input)="onSearchChange($event)" placeholder="Search" />
    </span>
  </div>
  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.materialType" optionLabel="text" [showToggleAll]="false"
      [disabled]="unsavedChanges" optionValue="value" selectedItemsLabel="{0} columns selected"
      [(ngModel)]="materialTypeSelected" (onChange)="applyComponentTypeFilter($event,'materialType')"
      styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="materialTypeSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'"
      filterPlaceHolder="Search" placeholder="Material Type">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="materialTypeSelected?.length">
          <i class="pull-right pi pi-filter-slash"
            (click)="materialTypeSelected = ''; applyComponentTypeFilter(materialTypeSelected,'materialType')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>
  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.mGroup" optionLabel="text" [showToggleAll]="false"
      [disabled]="unsavedChanges" optionValue="value" selectedItemsLabel="{0} columns selected"
      [(ngModel)]="groupSelected" (onChange)="applyComponentTypeFilter($event,'mGroup')"
      [dropdownIcon]="groupSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'"
      styleClass="lightBlueBG odin-lightBlueBG py-0" filterPlaceHolder="Search" placeholder="Material Group">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="groupSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="groupSelected = ''; applyComponentTypeFilter(groupSelected,'mGroup')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>
  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.od" optionLabel="text" optionValue="value"
      [disabled]="unsavedChanges" selectedItemsLabel="{0} columns selected" [showToggleAll]="false"
      [(ngModel)]="odSelected" (onChange)="applyComponentTypeFilter($event,'od')"
      styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="odSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'" filterPlaceHolder="Search"
      placeholder="OD">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="odSelected?.length">
          <i class="pi pi-filter-slash" (click)="odSelected = ''; applyComponentTypeFilter(odSelected,'od')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.sourService" optionLabel="text" [disabled]="unsavedChanges"
      optionValue="value" selectedItemsLabel="{0} columns selected" [(ngModel)]="sourServiceSelected"
      [showToggleAll]="false" (onChange)="applyComponentTypeFilter($event,'sourService')"
      styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="sourServiceSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'"
      filterPlaceHolder="Search" placeholder="Sour Service">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="sourServiceSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="sourServiceSelected = ''; applyComponentTypeFilter(sourServiceSelected,'sourService')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>
  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.vendor" optionLabel="text" [disabled]="unsavedChanges"
      optionValue="value" selectedItemsLabel="{0} columns selected" [(ngModel)]="vendorSelected" [showToggleAll]="false"
      (onChange)="applyComponentTypeFilter($event,'vendor')" styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="vendorSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'" filterPlaceHolder="Search"
      placeholder="Vendor">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="vendorSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="vendorSelected = ''; applyComponentTypeFilter(vendorSelected,'vendor')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.weight" optionLabel="text" [disabled]="unsavedChanges"
      optionValue="value" selectedItemsLabel="{0} columns selected" [(ngModel)]="weightsSelected"
      [showToggleAll]="false" (onChange)="applyComponentTypeFilter($event,'weight')"
      styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="weightsSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'" filterPlaceHolder="Search"
      placeholder="Weight">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="weightsSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="weightsSelected = ''; applyComponentTypeFilter(weightsSelected,'weight')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.grade" optionLabel="text" [disabled]="unsavedChanges"
      optionValue="value" selectedItemsLabel="{0} columns selected" [(ngModel)]="gradeSelected" [showToggleAll]="false"
      (onChange)="applyComponentTypeFilter($event,'grade')" styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="gradeSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'" filterPlaceHolder="Search"
      placeholder="Grade">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="gradeSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="gradeSelected = ''; applyComponentTypeFilter(gradeSelected,'grade')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>


  <div>
    <p-multiSelect [options]="odinFilteredDropDownValue.connection" optionLabel="text" [disabled]="unsavedChanges"
      optionValue="value" selectedItemsLabel="{0} columns selected" [(ngModel)]="connectionSelected"
      [showToggleAll]="false" (onChange)="applyComponentTypeFilter($event,'connection')"
      styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="connectionSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'"
      filterPlaceHolder="Search" placeholder="Connection">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="connectionSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="connectionSelected = ''; applyComponentTypeFilter(connectionSelected,'connection')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>
  <!-- Project Filter -->
  <div>
    <p-multiSelect [options]="projects" optionLabel="text" optionValue="value" [(ngModel)]="projectSelected"
      [disabled]="unsavedChanges" [showToggleAll]="false" selectedItemsLabel="{0} columns selected"
      (onChange)="applyProjectFilter($event, 'project')" styleClass="lightBlueBG odin-lightBlueBG py-0"
      [dropdownIcon]="projectSelected?.length ? 'pi pi-filter-fill' : 'pi pi-chevron-down'" filterPlaceHolder="Search"
      placeholder="Project">
      <ng-template pTemplate="header">
        <div class="clear-selection mr-2" *ngIf="projectSelected?.length">
          <i class="pi pi-filter-slash"
            (click)="projectSelected = ''; applyProjectFilter(projectSelected, 'project')"></i>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <div>
    <div class="flex flex-wrap gap-1 justify-content lightBlueBG odin-lightBlueBG displaytoggler pt-1 pl-2 pr-2"
      *ngIf="selectedRadioSummaryColumns">

      <p-checkbox name="All" class="select-all-checkbox" (onChange)="toggleSelectAll($event)" [label]="'All'"
        [(ngModel)]="selectAll" [value]="true" [disabled]="!selectedWells?.length">
      </p-checkbox>
      <!-- {{selectedCategory}} -->
      <div *ngFor="let category of selectedRadioSummaryColumns" class="project-group mt-1 card">
        <div class="card-header project-header flex align-items-center">
          <p-checkbox [disabled]="!selectedWells?.length" name="category" class="project-checkbox"
            (click)="onSelectCategory()" [(ngModel)]="selectedCategory" [label]="category.LOOKUPDISPLAYTEXT"
            [value]="category.LOOKUPTEXT" />
        </div>
      </div>
    </div>
  </div>


  <div class="pull-right pl-2">
    <p-button title="Clear Filter" class="filterBTN ml-1 text-gray-600"
      (click)="clearAllFilters(searchOdinDashboard)" icon="pi pi-filter-slash" severity="secondary"></p-button>
   <p-button class="p-button-outlined p-button-secondary saveUI ml-2 save-user-btn"
          icon="pi"  
          pTooltip="Save Personalization"
          tooltipPosition="top"
          (onClick)="onSaveState()">
    </p-button>
    <p-button icon="pi" class="p-button-outlined p-button-secondary reset-ui-button ml-2"
      pTooltip="Reset Personalization" tooltipPosition="top" (onClick)="onResetState()">
    </p-button>
  </div>


</div>

<ag-grid-angular [rowData]="filterData" [loading]="loading" [rowHeight]="30" [columnDefs]="columnDefs"
  [tooltipShowDelay]="tooltipShowDelay" [tooltipHideDelay]="tooltipHideDelay" [tooltipInteraction]="true"
  [quickFilterText]="quickFilterText" [overlayLoadingTemplate]="loading ? 'Loading...' : null"
  (gridReady)="onGridReady($event)" [grandTotalRow]="'bottom'" (firstDataRendered)="onFirstDataRendered($event)"
  [ngStyle]="{ height: height$ | async }" class="ag-theme-alpine" [isExternalFilterPresent]="isExternalFilterPresent"
  [doesExternalFilterPass]="doesExternalFilterPass" [paginationPageSizeSelector]="false"
  (cellValueChanged)="onCellValueChanged($event)" [sideBar]="sideBar" [singleClickEdit]="true"
  [infiniteInitialRowCount]="500" rowSelection="multiple" (selectionChanged)="onSelectionChanged($event)"
  (cellClicked)="onCellClick($event)"
  [defaultColDef]="{ flex: 1, minWidth: 120, sortable: true, filter: true,resizable: true,suppressHeaderMenuButton: true , aggFunc: 'sum' }"
  [animateRows]="true" (filterChanged)="onFilterChanged($event)">
</ag-grid-angular>

<div class="pagination-block">
  <div>
    <span class="labeltxt">Total Records:</span> {{totalRecords ? totalRecords : 0}}
  </div>
  <div>
    <p-button label="Rig Schedule Analysis" (onClick)="onRigAnalysisPage()" [disabled]="isButtonDisabled"
      class="mr-2 green"></p-button>
    <p-button label="Cancel" (onClick)="resetOdinGrid()" [outlined]="true" [disabled]="!isEdit"></p-button>
    <p-button label="Save" (onClick)="onSave()" class="ml-2" [disabled]="!isEdit"></p-button>
    <!--<p-button label="Preview" (click) ="previewEditForWells()"  class="ml-2 green"  [disabled]="!isEdit"></p-button>-->
  </div>
</div>

<p-overlayPanel #overlayAddEquipment styleClass="crn-overlay-panel"
  showTransitionOptions=".12s cubic-bezier(0, 0, 0.2, 1)">
  <ng-template pTemplate="content">
    <div *ngIf="isNewRowABoveOrBelowAllowed" class="flex overlay-item">
      <span (click)="insertRowToAdd(true)"> Add Equipment Above </span>
    </div>
    <div *ngIf="isNewRowABoveOrBelowAllowed" class="flex overlay-item">
      <span (click)="insertRowToAdd(false)"> Add Equipment Below </span>
    </div>
    <div *ngIf="isNewRowABoveOrBelowAllowed" class="flex overlay-item">
      <span (click)="deleteEquipmentRow()"> Delete Equipment </span>
    </div>
  </ng-template>
</p-overlayPanel>
<app-equipmwnt-dialog [(displayEquipmentDialog)]="displayEquipmentDialog"
  (equipmentDialogData)="equipmentDialogData($event)" (onClose)="displayEquipmentDialog=false;"></app-equipmwnt-dialog>

<app-confirmation-dialog [(visible)]="displaySaveComponentDialog" [dialogContent]="pageContent"
  [dialogTitle]="pageTitle" [countinueButtonName]="'Save'" (onCancel)="displaySaveComponentDialog=false"
  (onContinue)="saveOdinGrid()" [cancelButtonVisibile]="'true'">
</app-confirmation-dialog>

<app-delete-confirmation-dialog [(displayDeleteComponentDialog)]="displayDeleteComponentDialog"
  [dialogContent]="pageContent" [buttonName]="buttonName" [dialogTitle]="pageTitle"
  (onClose)="displayDeleteComponentDialog=false;"
  (onDelete)="deleteOrEditEquipmentRow()"></app-delete-confirmation-dialog>

<app-proceed-confirmation-dialog [(displayProceedComponentDialog)]="displayProceedComponentDialog"
  (onProceed)="deleteEditWells()" (onClose)="displayProceedComponentDialog=false;"></app-proceed-confirmation-dialog>

<!-- Confirmation dialog for delete Equipment row -->
<p-dialog [(visible)]="showDeleteConfirmation" [modal]="true" [style]="{ width: '70vw' ,height:'50vh' }"
  [closable]="false">
  <div class="dialog-header">
    <h3 class="dialog-heading">{{deleteConfirmationTitle}}</h3>
    <button class="dialog-header-close-btn" pButton icon="pi pi-times"
      (click)="showDeleteConfirmation = false"></button>
  </div>
  <div class="pl-4 pt-6 pb-6 parentDiv"> <i class="pi pi-info-circle iconSize"></i><span class="ml-2"
      [innerHTML]="deleteConfirmationMessage"> </span></div>
  <ng-template pTemplate="message">

    <div class="well-info mr-1 ml-1">
      <p-table [value]="[selectedEquipment]">


        <ng-template pTemplate="header">
          <tr>
            <th id="Equipment" alignFrozen="left" pFrozenColumn [frozen]="true" rowspan="2"
              style="max-width: 250px;min-width: 250px;">Equipment</th>
            <ng-container *ngFor="let item of selectedEquipmentWellList; let i = index;">
              <th colspan="2" style="border-color: #fff" [style.background-color]="i%2==0? '#ebfab7' : '#e2eafd'"
                class="text-center">
                {{
                item.wellName
                }}
              </th>
            </ng-container>
          </tr>
          <tr>
            <ng-container *ngFor="let item of selectedEquipmentWellList; let i = index;">
              <th style="border-color: #fff" [style.background-color]="i%2==0? '#ebfab7' : '#e2eafd'"
                class="text-center" style="max-width: 100px;">Primary</th>
              <th style="border-color: #fff" [style.background-color]="i%2==0? '#ebfab7' : '#e2eafd'"
                class="text-center" style="max-width: 100px;">Contingency</th>
            </ng-container>
          </tr>
        </ng-template>


        <ng-template pTemplate="body" let-claim let-columns="columns" let-rowIndex="rowIndex">
          <tr>
            <td alignFrozen="left" pFrozenColumn [frozen]="true">
              {{selectedEquipment.materialShortDesc}}
            </td>
            <ng-container *ngFor="let item of selectedEquipmentWellList;  let i = index;">
              <td class="text-center" style="border-color: #fff;max-width: 100px;"
                [style.background-color]="i%2==0? '#ebfab7' : '#e2eafd'">
                {{
                (item.primaryQuantity ?? 0)
                | number: '1.0-1'
                }}
              </td>
              <td class="text-center" style="border-color: #fff;max-width: 100px;"
                [style.background-color]="i%2==0? '#ebfab7' : '#e2eafd'">
                {{
                (item.contingentQuantity ??
                0) | number: '1.0-1'
                }}
              </td>
            </ng-container>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button type="button" pButton class="p-button-outlined mb-1" label="Cancel"
      (click)="showDeleteConfirmation = false"></button>
    <button type="button" pButton class="delete-action-btn mt-2 deleteButton"
      [label]="hasPrimaryORContingency ? 'Edit Wells' : 'Delete'" (click)="deleteOrEditEquipmentRow()"></button>
  </ng-template>
</p-dialog>